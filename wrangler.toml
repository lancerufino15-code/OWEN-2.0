# Purpose: Wrangler configuration for the OWEN Worker (bindings, assets, envs).
# Used by: `wrangler dev` / `wrangler deploy` to build and run the Worker.
# Assumptions: values here are non-secret defaults; secrets are set via `wrangler secret`.
name = "llm-chat-app-template"
main = "src/index.ts"
compatibility_date = "2025-11-01"
workers_dev = true

# Serve everything in /public at the Worker root
assets = { directory = "public" }

[browser]
binding = "BROWSER"
remote = true

[ai]
binding = "AI"

[vars]
# OpenAI REST base; do not hardcode secrets
OPENAI_API_BASE = "https://api.openai.com/v1"
DEFAULT_MODEL = "gpt-4-turbo"
SYSTEM_NAME = "Owen"
ADMIN_KEY = "set-me"
FACULTY_PASSCODE = "set-me"
CF_ACCOUNT_ID = "4498532b94311a97b214f7df1fc8db76"
# CF_BROWSER_BASE_URL = "https://api.cloudflare.com/client/v4/accounts/${CF_ACCOUNT_ID}/browser-rendering"

[[r2_buckets]]
binding = "OWEN_BUCKET"
bucket_name = "owen-bucket"

[[r2_buckets]]
binding = "OWEN_INGEST"
bucket_name = "owen-ingest"

[[r2_buckets]]
binding = "OWEN_NOTES"
bucket_name = "owen-notes"

[[r2_buckets]]
binding = "OWEN_TEST"
bucket_name = "owen-test"

[[r2_buckets]]
binding = "OWEN_UPLOADS"
bucket_name = "owen-uploads"

[[r2_buckets]]
binding = "OWN_INGEST"
bucket_name = "own-ingest"

[[r2_buckets]]
binding = "OWEN_ANALYTICS"
bucket_name = "owen-analytics"

# Environment-specific overrides
[env.production]

[env.production.ai]
binding = "AI"

[[env.production.r2_buckets]]
binding = "OWEN_ANALYTICS"
bucket_name = "owen-analytics"

[[env.production.kv_namespaces]]
binding = "OWEN_DIAG_KV"
id = "d678f47eeaf944b1b96313af8fdd15b2"

[[env.production.kv_namespaces]]
binding = "OWEN_DOC_CACHE"
id = "640f9257248b4d7c8ca1a9f6910f124c"

[env.production.browser]
binding = "BROWSER"
remote = true

# KV namespace for persistent vector store id cache
[[kv_namespaces]]
binding = "DOCS_KV"
id = "d678f47eeaf944b1b96313af8fdd15b2"

[[kv_namespaces]]
binding = "OWEN_DOC_CACHE"
id = "640f9257248b4d7c8ca1a9f6910f124c"

# KV namespace for diagnostics (last ask + analytics key snapshots)
[[kv_namespaces]]
binding = "OWEN_DIAG_KV"
id = "d678f47eeaf944b1b96313af8fdd15b2"

# IMPORTANT:
# Set OPENAI_API_KEY via:
#   bunx wrangler secret put OPENAI_API_KEY
# Set CF_BROWSER_API_TOKEN via:
#   bunx wrangler secret put CF_BROWSER_API_TOKEN
